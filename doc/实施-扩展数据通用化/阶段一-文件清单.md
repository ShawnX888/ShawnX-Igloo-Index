# é˜¶æ®µä¸€ï¼šæ–‡ä»¶æ¸…å• - useExtendedWeatherDataForOverlayChart å¼•ç”¨

## æœç´¢æ—¶é—´
2025-12-18

## æœç´¢èŒƒå›´
- `Next-gen-index/src/` ç›®å½•
- `Next-gen-index/` ç›®å½•ï¼ˆå®Œæ•´æœç´¢ï¼‰

---

## å¼•ç”¨ç»Ÿè®¡

### æ€»å¼•ç”¨æ•°ï¼š7 å¤„

### æŒ‰æ–‡ä»¶åˆ†ç±»ï¼š
1. **Hook æ–‡ä»¶æœ¬èº«**ï¼š5 å¤„
   - å‡½æ•°å®šä¹‰ï¼š1 å¤„
   - console.warn æ—¥å¿—ï¼š4 å¤„

2. **ç»„ä»¶æ–‡ä»¶**ï¼š2 å¤„
   - å¯¼å…¥è¯­å¥ï¼š1 å¤„
   - å‡½æ•°è°ƒç”¨ï¼š1 å¤„

---

## è¯¦ç»†æ–‡ä»¶æ¸…å•

### 1. Hook æ–‡ä»¶æœ¬èº«

**æ–‡ä»¶è·¯å¾„**ï¼š`Next-gen-index/src/hooks/useExtendedWeatherDataForOverlayChart.ts`

**å¼•ç”¨è¯¦æƒ…**ï¼š

| è¡Œå· | ç±»å‹ | å†…å®¹ | éœ€è¦ä¿®æ”¹ |
|------|------|------|----------|
| 1-13 | æ–‡ä»¶æ³¨é‡Š | æ–‡ä»¶é¡¶éƒ¨æ³¨é‡Šï¼Œè¯´æ˜"ä¸ºé£é™©å åŠ ç¤ºæ„å›¾è·å–æ‰©å±•çš„å¤©æ°”æ•°æ®" | âœ… éœ€è¦æ›´æ–°ä¸ºé€šç”¨åŒ–è¯´æ˜ |
| 22-31 | å‡½æ•°æ–‡æ¡£æ³¨é‡Š | JSDoc æ³¨é‡Šï¼Œè¯´æ˜"ä¸ºé£é™©å åŠ ç¤ºæ„å›¾è·å–æ‰©å±•çš„å¤©æ°”æ•°æ®" | âœ… éœ€è¦æ›´æ–°ä¸ºé€šç”¨åŒ–è¯´æ˜ |
| 32 | å‡½æ•°å®šä¹‰ | `export function useExtendedWeatherDataForOverlayChart(` | âœ… éœ€è¦é‡å‘½åä¸º `useExtendedWeatherData` |
| 138 | console.warn | `console.warn('[useExtendedWeatherDataForOverlayChart] extendedDateRange is null...` | âœ… éœ€è¦æ›´æ–°å‡½æ•°å |
| 147 | console.warn | `console.warn('[useExtendedWeatherDataForOverlayChart] Extended hourly data is empty...` | âœ… éœ€è¦æ›´æ–°å‡½æ•°å |
| 163 | console.warn | `console.warn('[useExtendedWeatherDataForOverlayChart] extendedDateRange is null...` | âœ… éœ€è¦æ›´æ–°å‡½æ•°å |
| 172 | console.warn | `console.warn('[useExtendedWeatherDataForOverlayChart] Extended daily data is empty...` | âœ… éœ€è¦æ›´æ–°å‡½æ•°å |

**éœ€è¦ä¿®æ”¹çš„å†…å®¹**ï¼š
- æ–‡ä»¶é‡å‘½åï¼š`useExtendedWeatherDataForOverlayChart.ts` â†’ `useExtendedWeatherData.ts`
- å‡½æ•°åé‡å‘½åï¼š`useExtendedWeatherDataForOverlayChart` â†’ `useExtendedWeatherData`
- æ³¨é‡Šæ›´æ–°ï¼šä»"ä¸ºé£é™©å åŠ ç¤ºæ„å›¾"æ”¹ä¸º"é€šç”¨æ‰©å±•æ•°æ®è·å– Hookï¼Œç”¨äºé£é™©å åŠ ç¤ºæ„å›¾å’Œé£é™©äº‹ä»¶è®¡ç®—"
- console.warn ä¸­çš„å‡½æ•°åæ›´æ–°

**æ‰©å±•æ—¶é—´èŒƒå›´è®¡ç®—é€»è¾‘æ£€æŸ¥**ï¼š
- ç¬¬ 73 è¡Œï¼šå°æ—¶çº§çª—å£ - `subHours(baseTime, windowSize)` âœ… ä¿æŒåŸæœ‰æ—¶åˆ»ï¼ˆæ­£ç¡®ï¼‰
- ç¬¬ 76 è¡Œï¼šå¤©çº§çª—å£ - `subDays(dateRange.from, windowSize)` ç„¶åå¯¹é½åˆ° 00:00:00 UTC âœ… å·²å¯¹é½ï¼ˆæ­£ç¡®ï¼‰
- ç¬¬ 87 è¡Œï¼šå‘¨çº§çª—å£ - `subWeeks(dateRange.from, windowSize)` ç„¶åå¯¹é½åˆ° 00:00:00 UTC âœ… å·²å¯¹é½ï¼ˆæ­£ç¡®ï¼‰
- ç¬¬ 98 è¡Œï¼šæœˆçº§çª—å£ - `startOfMonth(dateRange.from)` ç„¶åå¯¹é½åˆ° 00:00:00 UTC âœ… å·²å¯¹é½ï¼ˆæ­£ç¡®ï¼‰

**æ³¨æ„**ï¼šå½“å‰å®ç°å·²ç»å°†å¤©çº§ã€å‘¨çº§ã€æœˆçº§çª—å£å¯¹é½åˆ° 00:00:00 UTCï¼Œç¬¦åˆè¦æ±‚ã€‚

---

### 2. ç»„ä»¶æ–‡ä»¶

**æ–‡ä»¶è·¯å¾„**ï¼š`Next-gen-index/src/components/home/DataDashboard.tsx`

**å¼•ç”¨è¯¦æƒ…**ï¼š

| è¡Œå· | ç±»å‹ | å†…å®¹ | éœ€è¦ä¿®æ”¹ |
|------|------|------|----------|
| 14 | å¯¼å…¥è¯­å¥ | `import { useExtendedWeatherDataForOverlayChart } from "../../hooks/useExtendedWeatherDataForOverlayChart";` | âœ… éœ€è¦æ›´æ–°å¯¼å…¥è·¯å¾„å’Œå‡½æ•°å |
| 74 | å‡½æ•°è°ƒç”¨ | `} = useExtendedWeatherDataForOverlayChart(` | âœ… éœ€è¦æ›´æ–°å‡½æ•°å |

**ä¸Šä¸‹æ–‡ä»£ç **ï¼š
```typescript
// ç¬¬ 14 è¡Œï¼šå¯¼å…¥è¯­å¥
import { useExtendedWeatherDataForOverlayChart } from "../../hooks/useExtendedWeatherDataForOverlayChart";

// ç¬¬ 70-79 è¡Œï¼šå‡½æ•°è°ƒç”¨
// Get extended weather data for overlay chart (to ensure accurate calculation at start position)
const {
  extendedHourlyData,
  extendedDailyData,
} = useExtendedWeatherDataForOverlayChart(
  selectedRegion,
  dateRange,
  weatherDataType,
  'rainfall',
  selectedProduct
);
```

**éœ€è¦ä¿®æ”¹çš„å†…å®¹**ï¼š
- å¯¼å…¥è¯­å¥ï¼šæ›´æ–°å¯¼å…¥è·¯å¾„å’Œå‡½æ•°å
- å‡½æ•°è°ƒç”¨ï¼šæ›´æ–°å‡½æ•°å
- æ³¨é‡Šï¼šå¯ä»¥æ›´æ–°ä¸º"è·å–æ‰©å±•å¤©æ°”æ•°æ®ï¼ˆç”¨äºé£é™©å åŠ ç¤ºæ„å›¾å’Œé£é™©äº‹ä»¶è®¡ç®—ï¼‰"

---

## å…¶ä»–å¯èƒ½çš„ä½ç½®æ£€æŸ¥

### ç±»å‹å®šä¹‰æ–‡ä»¶
- âœ… æœªæ‰¾åˆ°ç±»å‹å®šä¹‰æ–‡ä»¶ä¸­çš„å¼•ç”¨

### æµ‹è¯•æ–‡ä»¶
- âœ… æœªæ‰¾åˆ°æµ‹è¯•æ–‡ä»¶ï¼ˆé¡¹ç›®å¯èƒ½æ²¡æœ‰æµ‹è¯•æ–‡ä»¶ï¼‰

### å·¥å…·å‡½æ•°æ–‡ä»¶
- âœ… æœªæ‰¾åˆ°å·¥å…·å‡½æ•°æ–‡ä»¶ä¸­çš„å¼•ç”¨

### å…¶ä»–ç»„ä»¶æ–‡ä»¶
- âœ… æœªæ‰¾åˆ°å…¶ä»–ç»„ä»¶æ–‡ä»¶ä¸­çš„å¼•ç”¨

---

## ä¿®æ”¹ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
1. **Hook æ–‡ä»¶é‡å‘½åå’Œå‡½æ•°é‡å‘½å**ï¼ˆæ­¥éª¤ 2.1ï¼‰
   - æ–‡ä»¶ï¼š`useExtendedWeatherDataForOverlayChart.ts` â†’ `useExtendedWeatherData.ts`
   - å‡½æ•°ï¼š`useExtendedWeatherDataForOverlayChart` â†’ `useExtendedWeatherData`

2. **DataDashboard ç»„ä»¶æ›´æ–°**ï¼ˆæ­¥éª¤ 4.1ï¼‰
   - å¯¼å…¥è¯­å¥æ›´æ–°
   - å‡½æ•°è°ƒç”¨æ›´æ–°

### ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®ä¿®æ”¹ï¼‰
3. **æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²æ›´æ–°**ï¼ˆæ­¥éª¤ 2.1, 6.1ï¼‰
   - Hook æ–‡ä»¶æ³¨é‡Š
   - å‡½æ•°æ–‡æ¡£æ³¨é‡Š
   - console.warn ä¸­çš„å‡½æ•°å

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰
4. **ä»£ç æ³¨é‡Šä¼˜åŒ–**ï¼ˆæ­¥éª¤ 6.1ï¼‰
   - DataDashboard ä¸­çš„æ³¨é‡Šå¯ä»¥æ›´æ–°

---

## éªŒè¯æ¸…å•

### æ­¥éª¤ 1.1 éªŒè¯ç‚¹
- [x] æ‰€æœ‰å¼•ç”¨éƒ½å·²æ‰¾åˆ°ï¼ˆ7 å¤„ï¼‰
- [x] æ²¡æœ‰é—æ¼çš„æ–‡ä»¶
- [x] æ–‡ä»¶æ¸…å•å®Œæ•´ï¼ˆåŒ…å«æ–‡ä»¶è·¯å¾„å’Œè¡Œå·ï¼‰
- [x] å¼•ç”¨ç»Ÿè®¡å‡†ç¡®ï¼ˆæŒ‰æ–‡ä»¶åˆ†ç±»ï¼‰

### é¢å¤–å‘ç°
- [x] æ‰©å±•æ—¶é—´èŒƒå›´è®¡ç®—é€»è¾‘å·²ç¬¦åˆè¦æ±‚ï¼ˆå¤©çº§ã€å‘¨çº§ã€æœˆçº§å·²å¯¹é½åˆ° 00:00:00 UTCï¼‰
- [x] å½“å‰å®ç°å·²ç»å¤„ç†äº†æ—¶åŒºé—®é¢˜ï¼ˆä½¿ç”¨ UTC æ—¶é—´ï¼‰

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

æ ¹æ®å®æ–½è®¡åˆ’ï¼Œä¸‹ä¸€æ­¥æ˜¯ï¼š

**é˜¶æ®µäºŒï¼šHook é‡å‘½åä¸é€šç”¨åŒ–**
- æ­¥éª¤ 2.1ï¼šHook æ–‡ä»¶é‡å‘½å
- æ­¥éª¤ 2.2ï¼šæ›´æ–°æ‰©å±•æ—¶é—´èŒƒå›´è®¡ç®—é€»è¾‘ï¼ˆæ£€æŸ¥å‘ç°å·²ç¬¦åˆè¦æ±‚ï¼Œå¯èƒ½éœ€è¦éªŒè¯ï¼‰
- æ­¥éª¤ 2.3ï¼šéªŒè¯ Hook æ¥å£é€šç”¨æ€§

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-18  
**å®ŒæˆçŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

---

## åç»­é˜¶æ®µå®Œæˆæƒ…å†µ

### é˜¶æ®µäºŒï¼šHook é‡å‘½åä¸é€šç”¨åŒ–
- âœ… å·²å®Œæˆï¼ˆè¯¦è§ `é˜¶æ®µäºŒ-å®ŒæˆæŠ¥å‘Š.md`ï¼‰

### é˜¶æ®µä¸‰ï¼šé›†æˆåˆ°é£é™©äº‹ä»¶è®¡ç®—
- âœ… å·²å®Œæˆï¼ˆè¯¦è§ `é˜¶æ®µä¸‰-å®ŒæˆæŠ¥å‘Š.md`ï¼‰

### é˜¶æ®µå››ï¼šæ›´æ–°ç»„ä»¶å¼•ç”¨
- âœ… å·²å®Œæˆï¼ˆè¯¦è§ `é˜¶æ®µå››-å®ŒæˆæŠ¥å‘Š.md`ï¼‰

### é˜¶æ®µäº”ï¼šæµ‹è¯•ä¸éªŒè¯
- ğŸŸ¡ è¿›è¡Œä¸­ï¼ˆæ—¥å¿—å·²å¼€å¯ï¼Œæ‰€æœ‰é—®é¢˜å·²ä¿®å¤ï¼Œè¯¦è§ `é˜¶æ®µäº”-æµ‹è¯•æŠ¥å‘Š.md` å’Œ `é˜¶æ®µäº”-é—®é¢˜ä¿®å¤å®ŒæˆæŠ¥å‘Š.md`ï¼‰

