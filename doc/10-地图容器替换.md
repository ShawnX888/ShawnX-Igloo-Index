# 10-地图容器替换

## 步骤概述

### 步骤编号和名称
**步骤10**：地图容器替换

### 步骤目标
将现有的SVG模拟地图替换为真实的Google Maps容器，完成地图初始化和基础配置，为后续图层绘制做准备。

### 预期成果
- SVG模拟地图已移除
- Google Maps容器已集成
- 地图可以正常显示和交互
- 地图初始化和配置正确
- 为后续步骤提供可用的地图实例

---

## 前置条件

### 依赖的步骤
- **步骤03**：Google Maps API配置与初始化（需要地图API已加载）

### 需要完成的前置工作
- Google Maps API已成功加载
- 地图实例创建方法已了解

### 需要的数据/接口
- 地图容器：HTML div元素
- 地图配置：中心点、缩放级别等
- 地图实例：`google.maps.Map`类型

---

## 实现要点

### 核心功能点

1. **移除SVG模拟地图**
   - 移除`MapWorkspace`组件中的SVG代码
   - 保留必要的容器结构
   - 确保不影响其他功能

2. **集成Google Maps容器**
   - 在`MapWorkspace`组件中创建Google Maps容器div
   - 使用`useEffect`初始化地图实例
   - 配置地图初始中心点和缩放级别

3. **地图初始化和配置**
   - 设置地图中心点（默认：印尼雅加达）
   - 设置初始缩放级别
   - 配置地图类型和样式
   - 添加必要的地图控件

4. **保持现有功能**
   - 保持图层控制按钮的位置和功能
   - 保持GPS定位按钮的位置和功能
   - 确保overlay组件可以正常显示

### 技术实现方案

#### 1. 地图容器创建
```typescript
// 伪代码示例
export function MapWorkspace({ ... }) {
  const mapRef = useRef<HTMLDivElement>(null);
  const mapInstanceRef = useRef<google.maps.Map | null>(null);

  useEffect(() => {
    if (!mapRef.current) return;
    
    // 初始化地图
    const map = new google.maps.Map(mapRef.current, {
      center: { lat: -6.2088, lng: 106.8456 }, // 雅加达
      zoom: 11,
      mapId: 'YOUR_MAP_ID', // 如果需要自定义样式
    });
    
    mapInstanceRef.current = map;
  }, []);

  return (
    <div className="w-full h-full relative">
      <div ref={mapRef} className="w-full h-full" />
      {/* 保留overlay组件 */}
    </div>
  );
}
```

#### 2. 地图配置
- **中心点**：默认设置为印尼雅加达（根据需求文档）
- **缩放级别**：根据区域范围调整（建议11-13）
- **地图类型**：使用默认roadmap或自定义样式
- **控件**：可以添加缩放控件、地图类型控件等

### 关键代码结构

#### MapWorkspace组件结构
```typescript
// 伪代码示例
export function MapWorkspace({
  selectedRegion,
  dataType,
  riskData,
  selectedProduct,
  setSelectedRegion,
  activeInputMode,
  dateRange,
  allRegionsData
}: MapWorkspaceProps) {
  const mapRef = useRef<HTMLDivElement>(null);
  const mapInstanceRef = useRef<google.maps.Map | null>(null);

  useEffect(() => {
    // 初始化地图
  }, []);

  return (
    <div className="w-full h-full relative">
      {/* Google Maps容器 */}
      <div ref={mapRef} className="w-full h-full" />
      
      {/* 保留overlay组件 */}
      <div className="absolute ...">
        {/* 图层控制 */}
        {/* GPS定位按钮 */}
      </div>
    </div>
  );
}
```

---

## 输入输出

### 输入
- **地图容器**：HTML div元素（通过ref引用）
- **地图配置**：中心点坐标、缩放级别等
- **地图实例**：`google.maps.Map`实例（从步骤03获取）

### 输出
- **地图实例**：`google.maps.Map`实例（存储在ref中）
- **可用的地图容器**：可以在后续步骤中添加图层
- **地图交互功能**：缩放、拖拽等基础功能

---

## 验收标准

### 功能验收标准
- [ ] SVG模拟地图已完全移除
- [ ] Google Maps容器可以正常显示
- [ ] 地图可以正常缩放和拖拽
- [ ] 地图中心点设置为印尼雅加达（或默认区域）
- [ ] 地图实例可以正常访问（通过ref）
- [ ] 图层控制按钮和GPS定位按钮位置正确

### 性能验收标准
- [ ] 地图加载时间在3秒内
- [ ] 地图交互（缩放、拖拽）流畅，无明显卡顿

### 视觉验收标准
- [ ] 地图显示正常，无空白或错误
- [ ] 地图样式符合设计要求
- [ ] Overlay组件可以正常显示在地图上

---

## 注意事项

### 常见问题
1. **地图容器未正确初始化**
   - 确保容器div有明确的宽高
   - 确保在组件挂载后再初始化地图

2. **地图显示空白**
   - 检查API Key是否正确
   - 检查地图配置是否正确
   - 检查网络连接

3. **Overlay组件位置错误**
   - 确保使用absolute定位
   - 确保z-index设置正确

### 技术难点
- **地图实例生命周期管理**：确保在组件卸载时清理资源
- **地图配置与现有功能兼容**：确保不影响图层控制和GPS定位功能

### 扩展性考虑
- 地图实例存储在ref中，便于后续步骤访问
- 地图配置选项可以提取为常量，便于后续修改
- 预留自定义Map ID的配置，便于后续添加自定义样式

---

## 下一步

### 后续步骤的准备工作
- 地图容器已替换，可以在步骤11中绘制行政区域边界
- 地图实例已创建，可以在步骤12和13中添加数据图层
- 如果步骤02已完成，可以使用已定义的类型确保类型安全

### 数据/接口的传递
- 地图实例通过ref传递给后续步骤
- 地图配置选项可以在后续步骤中动态更新

---

**文档版本**：v1.0  
**创建日期**：2025-01-27  
**最后更新**：2025-01-27
