# Index Insurance 门户网站 - 需求分析文档

## 1. 项目概述

### 1.1 项目背景
打造一个 Index Insurance 专属门户网站，通过直观的可视化演示，帮助用户理解天气数据、风险事件和保险产品的运行机制。

### 1.2 项目目标
建立统一的 Index Insurance 专属门户，实现以下核心目标：

- **产品展示与教育**：通过差异化比较介绍 index insurance，集合多种创新的 index 保险产品，帮助用户理解其与传统保险的区别
- **数据集成**：集成历史、当前和预测的天气数据，提供全面的天气信息视图
- **可视化演示**：建立自定义地图和配套的数据面板，将 Index 产品叠加至天气数据，可视化风险评估原理以及风险事件的触发机制
- **智能交互**：引入情景式 AI 聊天窗口，降低用户使用门槛，提升交互体验
- **视觉体验**：UI 风格参考 Google Maps Platform 和 Apple App Store，打造现代、简洁、直观的用户界面

### 1.3 项目定位
- **目标市场**：全球范围（不限制特定地区）
- **核心价值**：教育性、透明性、交互性
- **产品类型**：门户网站（Web Application）

---

## 2. 用户需求分析

### 2.1 目标用户
- **保险产品开发者/设计者**：需要深入理解 index insurance 的工作原理，优化产品设计
- **潜在客户/投保人**：需要了解产品如何评估风险和触发理赔，建立信任
- **业务决策者**：需要直观看到不同区域、不同时间段的天气风险和产品表现，支持决策

### 2.2 使用场景

#### 场景 1：探索性浏览
- 用户首次访问网站
- 查看默认区域（印尼雅加达的一个"市/区"）的历史降雨和风险情况
- 通过 AI 对话窗口了解如何使用网站

#### 场景 2：产品对比分析
- 用户选择不同的保险产品
- 对比在同一区域、同一时间段的风险触发情况
- 理解不同产品阈值设置对风险识别的影响

#### 场景 3：区域风险分析
- 用户切换不同区域（国家-省/州-市/区）
- 查看该区域的天气模式和风险特征
- 了解不同区域的天气风险差异

#### 场景 4：时间趋势分析
- 用户调整时间窗口（历史数据最多 40 天，预测数据默认未来 10 天）
- 查看历史趋势或未来预测
- 分析风险事件的时间分布规律

#### 场景 5：AI 辅助查询
- 用户通过对话方式描述需求
- AI 帮助设置参数（行政区域、数据类型、时间范围、叠加的保险产品）
- 快速获得想要的可视化结果

#### 场景 6：GPS 定位
- 用户点击地图上的定位按钮
- 系统获取用户的 GPS 位置信息
- 自动识别并转换为对应的"国家 - 省/州 - 市/区"
- 地图自动定位到用户所在区域，并加载该区域的天气数据和风险分析

### 2.3 核心价值主张
- **教育性**：帮助用户理解 index insurance 的运作机制，降低认知门槛
- **透明性**：直观展示风险触发逻辑，增强用户信任
- **交互性**：通过 AI 和可视化，提供友好的交互体验

---

## 3. 功能需求

### 3.1 首页功能（降雨和风险）

首页竖直分为两个部分：自定义地图区域和数据面板区域。

#### 3.1.1 自定义地图功能

**地图基础**
- 基于 Google Maps JavaScript API 打造自定义地图
- 在 base map 的基础上，叠加多个数据图层

**图层 1：历史降雨量热力图**
- 以半透明 heatmap 的形式展示行政区的历史降雨量
- 展示以"市/区"级别划分的行政区域边界
- 区域内降雨量越大，颜色越深
- 同一区域的颜色晕染为：从中心往边界的逐渐变浅
- 当用户选择查看"历史降雨量"时，默认加载该图层

**图层 2：预测降雨量热力图**
- 以半透明 heatmap 的形式展示行政区的预测降雨量
- 展示以"市/区"级别划分的行政区域边界
- 区域内降雨量越大，颜色越深
- 同一区域的颜色晕染为：从中心往边界的逐渐变浅
- 当用户选择查看"预测降雨量"时，默认加载该图层

**图层 3：历史风险事件**
- 在图层 1 和 2 上方，基于历史降雨量，叠加展示已触发的风险事件的数量
- 在行政区中心上方，以半透明圆形染色区来代表风险事件数量
- 数量越多，圆形色块的面积越大，颜色越深
- 显示上引入动画效果：以一种风险从无到有的态势反复播放
- 对于选中的"市/区"，需要在染色区中心显示事件数量
- 当用户选择查看"历史降雨量"时，默认加载该图层

**图层 4：预测风险事件**
- 在图层 1 和 2 上方，基于预测降雨量，叠加展示可能触发的风险事件的数量
- 在行政区中心上方，以半透明圆形染色区来代表风险事件数量
- 数量越多，圆形色块的面积越大，颜色越深
- 显示上引入动画效果：以一种风险从无到有的态势反复播放
- 对于选中的"市/区"，需要在染色区中心显示事件数量
- 当用户选择查看"预测降雨量"时，默认加载该图层

**图层特性**
- 各个图层的颜色不同，便于区分
- 可以在地图上手动切换选中"市/区"所属"省/州"内的其他"市/区"

**图层展示控制**
- 提供 heatmap 图层开关，点击后显示可以开启/关闭的图层
- 当选择的数据类型是历史数据，则仅"historical rainfall"可以操作，点击切换开启/关闭
- 当选择的数据类型是预测数据，则仅"predicted rainfall"可以操作，点击切换开启/关闭
- UI 层面，设计参考 Google Map

#### 3.1.2 地图输入方式

两种输入方式只能激活一种。当一种激活时，最小化另一种。

**方式 1：手动选择**

1. **区域选择**
   - 支持模糊搜索
   - 按层级分步选择"国家 - 省/州 - 市/区"（支持全球范围）
   - 支持 GPS 一键定位：点击定位按钮后，系统自动获取用户当前位置的 GPS 坐标，并通过反向地理编码（Reverse Geocoding）转换为对应的"国家 - 省/州 - 市/区"，自动设置为当前选中区域

2. **选择数据类型**
   - "历史降雨量"或"预测降雨量"，二选一
   - 若选择的是"历史降雨量"，则需要设定时间窗口，明确起止日期和时刻（整数的小时，24 小时制）
     - 默认时间窗口为"当前日期 1 小时前"至"过去 7 天的相同时刻"
     - 限制：日期最多选择 40 天内的
   - 若选择的是"预测降雨量"，则设定默认时间窗口为"当前日期和时刻"至"未来 10 天的相同时刻"（整数的小时，24 小时制）

3. **选择需要叠加的保险产品卡片**
   - 仅能选中一个，可切换
   - 产品卡片涵盖图标和文字描述
   - 点击"more"可跳转到保险产品介绍页

4. **UI 设计**
   - 参考 Google Map，overlay 于地图最上层（不超出地图边界），尽量简洁

**方式 2：对话框输入（AI 咨询窗口）**

- 基于 Google Contextual View 的对话框
- 对话框采集的用户需求传入各个选项卡（行政区域、数据类型、时间范围、叠加的保险产品），并影响各部分的信息呈现
- UI 布局方面，overlay 于地图最上层（不超出地图边界）
- 展开时，置于地图右侧，1/4 宽度
- 运用 Google Maps Contextual View AI kit 和 Grounding Lite MCP 来打造

**默认设置**
首次进入网站时，默认设定区域为印尼雅加达的一个"市/区"，默认选择历史降雨量，默认时间窗口，不叠加任何保险产品。默认展开对话框。

#### 3.1.3 数据面板功能

该部分的信息基于第一部分的输入（指定的"市/区"、数据类型、时间窗口、叠加的保险产品），展示相应地从 mock data 获取的数据和图表，以及根据预定逻辑计算的数据和图表。

**分析汇总**
- 以卡片的形式，量化指标：
  - 时间窗口（天数 + 小时）
  - 窗口期内的平均降雨量
    - 若是日内产品，则统计并展示 avg. hourly rainfall
    - 若是周内或月度产品，则统计并展示 avg. daily rainfall
  - 窗口期内的总降雨量
  - 窗口期内的，选择产品的风险事件数量
  - 风险的严重程度

**降雨量柱状图**
- 默认按天展示，可手动切换为按小时展示
- 当选择 daily product 时，自动切换到 hourly view
- 当选择 weekly product 或 monthly drought product 时，自动切换到 daily view

**降雨量和风险的叠加示意图**

仅在指定了保险产品后，根据选定的保险产品类型展示相应的图。

- **日内产品**
  - 以 hourly view 的柱状图为底
  - 每根柱的值为"包含当前小时和此前连续 3 小时的降雨量累计值"
  - 主图上叠加阈值线
  - 若某根柱的值超过阈值线，则特殊显示

- **周度产品**
  - 以 daily view 的柱状图为底
  - 每根柱的值为"包含当天和此前连续 6 天的降雨量累计值"
  - 主图上叠加阈值线
  - 若某根柱的值超过阈值线，则特殊显示

- **月度产品**
  - 以 daily view 的面积图为底
  - 以每日降雨量为上沿线
  - 以一个完整自然月的降雨量累计值计算和显示面积
  - 若某月的累计值超过阈值，则特殊显示

**风险事件的触发情况**
- 仅在指定了保险产品后，按时间线呈现：那一月/哪一天/哪一小时，什么级别，触发类型等
- 展示风险事件的详细信息：所属的产品、区域、时间、级别

### 3.2 产品介绍页功能

#### 3.2.1 页面目标
- 图文并茂的介绍什么是 index insurance，与传统保险的区别
- 图文并茂的介绍不同的保险产品
- 整体风格新颖好看

#### 3.2.2 页面结构
总-分的结构。

#### 3.2.3 产品详情

**注意**：产品定义与风险触发规则可能存在差异。在实际配置触发条件时，请以 **#4.3.2 产品级风险事件触发条件** 中的规则为准。

**降雨量日内产品**
- 天气类型：降雨量
- 连续 4 小时的降雨量超过阈值：4-hour cumulative rainfall within one day (00:00 to 23:00) > threshold, once per day per policy
- 阈值 threshold 分 3 档：
  - 100mm
  - 120mm
  - 140mm
- 对应不同理赔额度

**降雨量周度产品**
- 天气类型：降雨量
- 7 天降雨量超过阈值：7-day cumulative rainfall within one month > threshold, once per month per policy
- 阈值 threshold 分 3 档：
  - 300mm
  - 350mm
  - 400mm
- 对应不同理赔额度

**降雨量月度产品**
- 天气类型：降雨量
- 当月降雨量低于阈值：cumulative rainfall of one month < threshold
- 阈值 threshold 分 3 档：
  - 60mm
  - 40mm
  - 20mm
- 对应不同理赔额度

#### 3.2.4 页面联动
可以通过"Simulate risk"跳转到首页查看指定产品的实际运行情况（设定默认参数，叠加该保险）。

---

## 4. 数据需求

### 4.1 Mock Rainfall Data 生成规则

#### 4.1.1 数据范围
- **时间范围**：过去 40 天至未来 10 天
- **时间粒度**：小时数据和每日数据
- **空间范围**：选择的"市/区"所属的"省/州"下所有的"市/区"

#### 4.1.2 生成策略
- 如果完全没有 mock data，生成新的
- 如果有部分 mock data 但不足，则补充
- 在用户选择"市/区"后，由系统实时生成

#### 4.1.3 数据格式
- 小时级数据：每个"市/区"每小时一个降雨量值（mm）
- 日级数据：每个"市/区"每天一个降雨量累计值（mm）

### 4.2 行政区域数据

#### 4.2.1 区域层级
- 国家（Country）
- 省/州（Province/State）
- 市/区（District/City）

#### 4.2.2 覆盖范围
- 需要支持模糊搜索和层级选择

### 4.3 风险事件计算规则

#### 4.3.1 计算依据
基于以下参数实时计算风险是否触发：
- 选择的产品
- 选择的"市/区"
- 选择的数据类型（历史/预测）
- 选择的时间范围
- Mock weather data（目前主要为降雨量数据）

#### 4.3.2 产品级风险事件触发条件

**降雨量日内产品**
- 触发条件：4-hour cumulative rainfall within one day (00:00 to 23:59) > threshold
- 阈值选项：100mm, 120mm, 140mm
- 触发级别：根据超过的阈值档位确定（tier 1, tier 2, tier 3）

**降雨量周度产品**
- 触发条件：7-day cumulative rainfall within one month > threshold
- 阈值选项：300mm, 350mm, 400mm
- 触发级别：根据超过的阈值档位确定（tier 1, tier 2, tier 3）

**降雨量月度产品**
- 触发条件：cumulative rainfall of one month < threshold
- 阈值选项：60mm, 40mm, 20mm
- 触发级别：根据低于的阈值档位确定（tier 1, tier 2, tier 3）

#### 4.3.3 风险事件记录
记录触发的风险事件，包含以下信息：
- 所属的产品
- 区域（市/区）
- 时间（年月日/小时）
- 级别：对应阈值档位，分为 tier 1, tier 2, tier 3

**风险严重程度汇总规则**：
- 若没有风险事件，为无 "-"
- 若最高级别的风险事件为 tier 1，为低
- 若最高级别的风险事件为 tier 2，为中
- 若最高级别的风险事件为 tier 3，为高

**注意**：目前该网站仅可视化产品级的风险事件触发条件，不涉及保单级的赔付原则。

---

## 5. 交互需求

### 5.1 用户操作流程

#### 5.1.1 首次访问流程
1. 用户进入网站
2. 系统加载默认设置：
   - 区域：印尼雅加达的一个"市/区"
   - 数据类型：历史降雨量
   - 时间窗口：默认时间窗口（当前日期 1 小时前至过去 7 天的相同时刻）
   - 保险产品：不叠加任何产品
   - AI 对话框：默认展开
3. 系统生成/加载该区域的 mock rainfall data
4. 地图展示历史降雨量热力图
5. 数据面板展示对应的分析数据

#### 5.1.2 参数修改流程
1. 用户通过手动选择或 AI 对话框修改参数（区域、数据类型、时间范围、保险产品）
2. 系统检查并生成/补充 mock rainfall data
3. 系统基于新参数重新计算风险事件
4. 地图图层和数据面板实时更新

#### 5.1.3 产品对比流程
1. 用户选择不同的保险产品
2. 系统基于相同的区域和时间范围，重新计算风险事件
3. 地图和数据面板更新，展示不同产品的风险触发情况
4. 用户可以通过切换产品，直观对比差异

### 5.2 参数设置方式

#### 5.2.1 手动选择
- 区域选择：模糊搜索、层级选择或 GPS 一键定位
- 数据类型：单选（历史/预测）
- 时间范围：日期选择器 + 小时选择器
- 保险产品：产品卡片选择（单选）

#### 5.2.3 GPS 定位
- 用户点击地图上的定位按钮（通常位于图层控制附近）
- 系统请求用户位置权限（首次使用时）
- 获取 GPS 坐标后，使用反向地理编码 API 转换为行政区域信息
- 自动设置选中的区域为"国家 - 省/州 - 市/区"
- 如果定位失败或无法转换为行政区域，提示用户并保持当前选择
- 定位成功后，地图自动缩放到该区域并加载相应的数据

#### 5.2.2 AI 对话框
- 用户通过自然语言描述需求
- AI 解析并设置对应参数
- 参数设置后，手动选择界面同步更新

### 5.3 视图切换规则

#### 5.3.1 地图图层切换
- 选择历史数据 → 仅显示历史降雨量图层和历史风险事件图层
- 选择预测数据 → 仅显示预测降雨量图层和预测风险事件图层
- 用户可以通过图层开关手动开启/关闭对应图层

#### 5.3.2 数据面板图表切换
- 选择日内产品 → 自动切换到 hourly view
- 选择周度或月度产品 → 自动切换到 daily view
- 用户也可以手动切换 hourly/daily view

#### 5.3.3 输入方式切换
- 手动选择和 AI 对话框两种方式只能激活一种
- 当一种激活时，另一种最小化

---

## 6. UI/UX 需求

### 6.1 视觉风格

#### 6.1.1 设计参考
- **Google Maps Platform**：地图交互、图层控制、overlay 设计
- **Apple App Store**：产品卡片设计、页面布局、视觉层次

#### 6.1.2 设计原则
- 简洁、现代、直观
- 信息层次清晰
- 视觉引导明确

### 6.2 交互细节

#### 6.2.1 地图交互
- 地图 overlay 不超出地图边界
- 支持地图缩放和拖拽
- 点击"市/区"可以切换选中区域
- 图层开关提供清晰的开启/关闭状态反馈
- GPS 定位按钮：位于地图控制区域，点击后显示定位状态（定位中/定位成功/定位失败）

#### 6.2.2 AI 对话框交互
- 展开时，置于地图右侧，1/4 宽度
- 对话界面生动美观
- 支持自然语言输入
- 参数设置后提供视觉反馈

#### 6.2.3 产品卡片交互
- 产品卡片包含图标和文字描述
- 选中状态有明显的视觉区分
- 点击"more"跳转到产品介绍页
- 支持快速切换产品

#### 6.2.4 数据面板交互
- 图表支持缩放和悬停查看详情
- 时间线支持点击查看风险事件详情
- 视图切换（hourly/daily）有平滑的过渡动画

### 6.3 数据可视化要求

#### 6.3.1 降雨量热力图
- 颜色深浅表示降雨量大小
- 从中心往边界逐渐变浅的晕染效果
- 半透明设计，不遮挡地图底图

#### 6.3.2 风险事件标记
- 圆形染色区，面积和颜色深度表示事件数量
- 动画效果：风险从无到有的态势反复播放
- 选中区域在染色区中心显示事件数量

#### 6.3.3 图表设计
- 柱状图：清晰的数值标注
- 面积图：渐变填充，视觉美观
- 阈值线：明显的视觉区分（如红色虚线）
- 超过阈值的数据点：特殊高亮显示

---

## 7. 非功能需求

### 7.1 性能要求
- **实时计算**：参数修改后，风险计算和视图更新应在 1 秒内完成
- **数据生成**：Mock rainfall data 的生成/补充应在 2 秒内完成
- **地图渲染**：地图图层切换应流畅，无明显卡顿
- **响应式设计**：支持不同屏幕尺寸，移动端和桌面端都有良好的体验

### 7.2 兼容性要求
- **浏览器兼容**：支持主流浏览器（Chrome, Firefox, Safari, Edge）
- **设备兼容**：支持桌面端、平板和移动端
- **API 兼容**：基于 Google Maps JavaScript API 的最新稳定版本

### 7.3 可维护性要求
- **代码结构**：前端代码已存在于 Next-gen-index/src，应遵循现有代码结构
- **组件化**：功能模块应组件化，便于维护和扩展
- **数据格式**：Mock data 和风险事件数据应有明确的格式定义

### 7.4 可扩展性要求
- **产品扩展**：支持未来添加新的保险产品类型
- **数据源扩展**：支持未来接入真实的天气数据 API
- **功能扩展**：支持未来添加保单级的赔付可视化

---

## 8. 约束条件

### 8.1 技术约束
- 前端代码已存在，需直接使用 Next-gen-index/src 下的代码
- 必须使用 Google Maps JavaScript API 构建地图
- AI 咨询窗口必须使用 Google Contextual View AI kit 和 Grounding Lite MCP
- 目前仅使用 Mock rainfall data，不接入真实天气 API

### 8.2 业务约束
- 历史数据最多选择 40 天内
- 预测数据默认未来 10 天
- 时间窗口需要明确起止日期和时刻（整数小时，24 小时制）
- 只能选择一个保险产品进行叠加
- 目前仅可视化产品级的风险事件触发条件，不涉及保单级

### 8.3 数据约束
- Mock rainfall data 在用户选择"市/区"后实时生成
- 时间范围：过去 40 天至未来 10 天
- 空间范围：选择的"市/区"所属的"省/州"下所有的"市/区"

---

## 9. 验收标准

### 9.1 功能验收
- [ ] 地图能够正确展示 4 个图层（历史/预测降雨量热力图、历史/预测风险事件）
- [ ] 手动选择和 AI 对话框两种输入方式可以正常工作
- [ ] Mock rainfall data 能够根据区域选择正确生成/补充
- [ ] 风险事件能够基于产品规则正确计算和展示
- [ ] 数据面板能够根据参数变化实时更新
- [ ] 产品介绍页能够正确展示产品信息和跳转功能

### 9.2 交互验收
- [ ] 地图图层可以手动开启/关闭
- [ ] 参数修改后，地图和数据面板能够实时更新
- [ ] AI 对话框能够正确解析用户需求并设置参数
- [ ] 产品切换后，风险计算结果能够正确更新
- [ ] 视图切换（hourly/daily）能够正常工作
- [ ] GPS 定位功能能够正确获取用户位置并转换为行政区域

### 9.3 视觉验收
- [ ] UI 风格符合 Google Maps Platform 和 Apple App Store 的设计参考
- [ ] 数据可视化清晰直观，易于理解
- [ ] 动画效果流畅自然
- [ ] 响应式设计在不同设备上表现良好

---

## 10. 附录

### 10.1 术语表
- **Index Insurance**：指数保险，基于客观指数（如降雨量）而非实际损失来触发理赔的保险产品
- **风险事件**：满足保险产品触发条件的事件，会记录时间、区域、级别等信息
- **产品级**：保险产品的风险事件触发条件定义
- **保单级**：具体保单的赔付原则定义（本网站暂不涉及）
- **Mock Data**：模拟数据，用于开发和演示

### 10.2 参考文档
- Figma 详细设计文档：`doc/figma-make详细设计.md`
- 前端代码：`Next-gen-index/src/`
- Google Maps Platform 文档：通过 MCP google-maps-platform-code-assist 获取

---

**文档版本**：v1.0  
**创建日期**：2024  
**最后更新**：2024
