# 21-页面间联动

## 步骤概述

### 步骤编号和名称
**步骤21**：页面间联动

### 步骤目标
实现首页与产品介绍页之间的跳转和参数传递，支持从产品介绍页的"Simulate risk"按钮跳转到首页并自动设置产品参数，确保页面间数据传递和状态同步。

### 预期成果
- 首页与产品介绍页的跳转功能正常工作
- 从产品介绍页跳转到首页时，可以自动设置产品参数
- 从首页跳转到产品介绍页时，可以传递当前产品信息
- 页面状态同步正常
- "Simulate risk"功能正常工作

---

## 前置条件

### 依赖的步骤
- **步骤15**：控制面板实现（需要产品选择功能）
- **步骤20**：图表可视化（需要完整的数据展示功能）

### 需要完成的前置工作
- 首页功能基本完成
- 产品介绍页已存在
- 产品选择功能已实现

### 需要的数据/接口
- 产品信息：`Product`类型
- 页面路由：`currentPage`状态
- 导航函数：`onNavigateToProduct`、`onNavigateToHome`

---

## 实现要点

### 核心功能点

1. **首页到产品介绍页的跳转**
   - 从产品选择器点击"more"按钮跳转
   - 传递当前选中的产品信息
   - 支持跳转到特定产品章节（scrollToSection）

2. **产品介绍页到首页的跳转**
   - 从"Simulate risk"按钮跳转
   - 传递产品信息，自动设置选中产品
   - 自动设置默认参数（区域、数据类型、时间范围）

3. **参数传递机制**
   - 使用状态管理传递产品信息
   - 使用URL参数或状态传递其他参数（如果需要）
   - 确保参数正确解析和设置

4. **页面状态同步**
   - 跳转时保持必要的状态
   - 跳转后正确初始化新页面的状态
   - 确保数据正确加载

### 技术实现方案

#### 1. 首页到产品介绍页的跳转
```typescript
// 伪代码示例
// 在Dashboard组件中
const handleNavigateToProduct = (section?: string) => {
  if (section) setScrollToSection(section);
  else setScrollToSection(null);
  setCurrentPage('product');
};

// 在ProductSelector组件中
<button
  onClick={() => onNavigateToProduct(`product-${product.id}`)}
  className="product-more-button"
>
  More
</button>
```

#### 2. 产品介绍页到首页的跳转
```typescript
// 伪代码示例
// 在ProductIntro组件中
const handleSimulateRisk = (product: InsuranceProduct) => {
  onNavigateToHome(product);
};

// 在App组件中
const handleNavigateToHome = (product?: InsuranceProduct) => {
  setDashboardInitialProduct(product || null);
  setCurrentPage('home');
};

// 在Dashboard组件中
useEffect(() => {
  if (initialProduct) {
    setSelectedProduct(initialProduct);
    // 设置默认参数
    setSelectedRegion(defaultRegion);
    setDataType('historical');
    setDateRange(defaultDateRange);
  }
}, [initialProduct]);
```

#### 3. 参数传递和状态同步
```typescript
// 伪代码示例
// App.tsx
export default function App() {
  const [currentPage, setCurrentPage] = useState<'home' | 'product'>('home');
  const [dashboardInitialProduct, setDashboardInitialProduct] = useState<InsuranceProduct | null>(null);
  const [scrollToSection, setScrollToSection] = useState<string | null>(null);

  const handleNavigateToProduct = (section?: string) => {
    if (section) setScrollToSection(section);
    else setScrollToSection(null);
    setCurrentPage('product');
  };

  const handleNavigateToHome = (product?: InsuranceProduct) => {
    setDashboardInitialProduct(product || null);
    setCurrentPage('home');
  };

  return (
    <div>
      <Header currentPage={currentPage} setCurrentPage={setCurrentPage} />
      <main>
        {currentPage === 'home' ? (
          <Dashboard
            onNavigateToProduct={handleNavigateToProduct}
            initialProduct={dashboardInitialProduct}
          />
        ) : (
          <ProductIntro
            onNavigateToHome={handleNavigateToHome}
            scrollToSection={scrollToSection}
          />
        )}
      </main>
    </div>
  );
}
```

### 关键代码结构

#### 页面导航组件
```typescript
// 伪代码示例
// App.tsx
export default function App() {
  // 页面状态管理
  // 导航函数
  // 参数传递
}
```

---

## 输入输出

### 输入
- **产品信息**：`Product`类型（从产品选择或产品介绍页获取）
- **导航操作**：用户点击跳转按钮
- **目标章节**：`string | null`类型（用于产品介绍页滚动）

### 输出
- **页面跳转**：切换到目标页面
- **参数设置**：自动设置产品和其他参数
- **状态更新**：更新页面状态和数据显示

---

## 验收标准

### 功能验收标准
- [ ] 首页与产品介绍页的跳转功能正常工作
- [ ] 从产品介绍页跳转到首页时，可以自动设置产品参数
- [ ] 从首页跳转到产品介绍页时，可以传递当前产品信息
- [ ] 页面状态同步正常
- [ ] "Simulate risk"功能正常工作
- [ ] 跳转到产品介绍页时，可以自动滚动到指定章节

### 交互验收标准
- [ ] 页面跳转流畅，无明显延迟
- [ ] 参数设置后，地图和数据面板可以正确更新
- [ ] 页面状态保持正确，不会丢失数据

### 数据质量验收标准
- [ ] 产品信息传递正确
- [ ] 参数设置正确（区域、数据类型、时间范围）
- [ ] 数据加载正确，与设置参数一致

---

## 注意事项

### 常见问题
1. **参数传递失败**
   - 确保产品信息正确传递
   - 确保状态管理正确

2. **页面状态不同步**
   - 确保跳转时正确更新状态
   - 确保新页面正确初始化

3. **数据加载失败**
   - 确保参数设置后触发数据重新加载
   - 处理数据加载错误

### 技术难点
- **状态管理**：需要正确管理页面间状态传递
- **参数解析**：需要正确解析和设置参数
- **数据同步**：需要确保页面间数据同步

### 扩展性考虑
- 页面导航可以扩展，支持更多页面类型
- 参数传递可以扩展，支持更多参数类型
- 支持未来添加更多页面间交互功能

---

## 下一步

### 后续步骤的准备工作
- 页面间联动已实现，用户流程基本完整
- 参数传递机制已实现，可以在后续步骤中使用

### 数据/接口的传递
- 产品信息通过状态管理传递
- 导航事件通过回调函数传递

---

**文档版本**：v1.0  
**创建日期**：2025-01-27  
**最后更新**：2025-01-27
