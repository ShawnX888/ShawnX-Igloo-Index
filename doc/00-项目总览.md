# 00-项目总览

## 1. 项目背景

### 1.1 项目概述
本项目旨在构建一个**Index Insurance 门户网站**，通过直观的可视化演示，帮助用户理解天气数据、风险事件和保险产品的运行机制。

### 1.2 项目目标
- **产品展示与教育**：通过差异化比较介绍 index insurance，集合多种创新的 index 保险产品
- **数据集成**：集成历史、当前和预测的天气数据，提供全面的天气信息视图
- **可视化演示**：建立自定义地图和配套的数据面板，将 Index 产品叠加至天气数据，可视化风险评估原理以及风险事件的触发机制
- **智能交互**：引入情景式 AI 聊天窗口，降低用户使用门槛，提升交互体验
- **视觉体验**：UI 风格参考 Google Maps Platform 和 Apple App Store，打造现代、简洁、直观的用户界面

### 1.3 项目定位
- **目标市场**：全球范围（不限制特定地区）
- **核心价值**：教育性、透明性、交互性
- **产品类型**：门户网站（Web Application）

---

## 2. 技术栈

### 2.1 前端框架和工具
- **React 19**：用于构建用户界面
- **TypeScript**：提供类型安全
- **Vite**：构建工具和开发服务器
- **Tailwind CSS**：样式框架
- **Framer Motion**：动画库

### 2.2 地图和AI集成（需新增）
- **Google Maps JavaScript API**：地图渲染和交互
- **Google Contextual View AI kit**：AI 对话界面
- **Grounding Lite MCP**：自然语言理解和参数提取

### 2.3 数据可视化
- **Recharts**：数据可视化图表库
- **自定义地图图层**：基于 Google Maps Data Layer 和 Polygon

### 2.4 其他依赖
- **date-fns**：日期处理
- **lucide-react**：图标库
- **radix-ui**：UI 组件库

---

## 3. 项目结构

### 3.1 目录结构
```
Next-gen-index/
├── src/
│   ├── App.tsx                    # 主应用组件
│   ├── main.tsx                   # 应用入口
│   ├── components/
│   │   ├── home/                  # 首页相关组件
│   │   │   ├── Dashboard.tsx     # 首页主组件
│   │   │   ├── MapWorkspace.tsx  # 地图工作区（需替换SVG为Google Maps）
│   │   │   ├── ControlPanel.tsx   # 手动选择面板
│   │   │   ├── ContextualAssistant.tsx  # AI对话面板
│   │   │   ├── ProductSelector.tsx      # 产品选择器
│   │   │   ├── DataDashboard.tsx       # 数据面板
│   │   │   └── types.ts                # 类型定义
│   │   ├── product/               # 产品介绍页相关组件
│   │   │   └── ProductIntro.tsx
│   │   ├── layout/                # 布局组件
│   │   │   └── Header.tsx
│   │   └── ui/                    # UI基础组件（shadcn/ui）
│   ├── lib/                       # 工具库
│   │   ├── mockData.ts           # Mock数据生成（需扩展）
│   │   └── utils.ts              # 工具函数
│   └── styles/                    # 样式文件
└── doc/                           # 项目文档
```

### 3.2 主要组件说明

#### 3.2.1 首页（Dashboard）
- **MapWorkspace**：地图工作区，当前使用SVG模拟地图，需要替换为Google Maps
- **ControlPanel**：手动选择面板，包含区域选择、数据类型切换、时间范围选择、产品选择
- **ContextualAssistant**：AI对话面板，使用Google Contextual View AI kit
- **ProductSelector**：产品选择器，显示可选的保险产品
- **DataDashboard**：数据面板，展示分析汇总、图表和风险事件时间线

#### 3.2.2 产品介绍页（ProductIntro）
- 图文并茂介绍index insurance和不同保险产品
- 支持从首页跳转并传递产品参数

---

## 4. 核心功能模块

### 4.1 地图可视化模块
- **Google Maps集成**：替换现有的SVG模拟地图
- **数据图层**：
  - 图层1：历史降雨量热力图
  - 图层2：预测降雨量热力图
  - 图层3：历史风险事件标记
  - 图层4：预测风险事件标记
- **图层控制**：支持开启/关闭图层
- **行政区域边界**：基于GeoJSON数据绘制Polygon

### 4.2 数据计算模块
- **Mock数据生成器**：根据区域和时间范围生成降雨量数据
- **保险产品库**：管理产品定义和产品级规则
- **风险计算引擎**：基于产品规则计算风险事件
- **数据缓存**：使用useMemo优化性能

### 4.3 用户交互模块
- **手动选择**：区域选择、数据类型切换、时间范围选择、产品选择
- **GPS定位**：获取用户位置并转换为行政区域
- **AI对话**：使用Contextual View和Grounding Lite实现自然语言交互
- **地图交互**：点击区域切换、图层控制

### 4.4 数据展示模块
- **分析汇总**：时间窗口、平均降雨量、总降雨量、风险事件数量、风险严重程度
- **图表可视化**：
  - 降雨量柱状图（按天/按小时）
  - 降雨量和风险叠加示意图（三种产品类型）
  - 风险事件触发时间线

---

## 5. 技术架构

### 5.1 组件架构
```
App
├── Header
└── Main
    ├── Dashboard (首页)
    │   ├── MapWorkspace (地图工作区)
    │   │   ├── Google Maps Container
    │   │   ├── Layer Controls (图层控制)
    │   │   └── Overlays (数据图层)
    │   ├── ControlPanel (手动选择面板)
    │   ├── ContextualAssistant (AI 对话面板)
    │   ├── ProductSelector (产品选择器)
    │   └── DataDashboard (数据面板)
    └── ProductIntro (产品介绍页)
```

### 5.2 数据流架构
```
用户操作 (手动/AI)
    ↓
参数变更 (selectedRegion, rainfallType, dateRange, selectedProduct)
    ↓
Mock 数据生成/补充 (useMemo 缓存)
    ↓
风险计算引擎 (从产品库获取产品规则)
    ↓
风险事件计算 (基于产品级规则)
    ↓
地图渲染更新 (图层更新)
    ↓
数据面板更新 (图表更新)
```

### 5.3 核心模块架构
```
保险产品库 (Product Library)
    ├── 产品定义 (产品级规则)
    │   ├── 触发条件
    │   ├── 阈值配置
    │   └── 风险级别定义
    └── 保单定义 (保单级规则) [未来扩展]

风险计算引擎 (Risk Calculation Engine)
    ├── 产品规则解析器
    ├── 风险事件计算器
    └── 结果格式化器

数据层
    ├── Mock 数据生成器
    └── 区域数据管理
```

---

## 6. 关键设计决策

### 6.1 地图图层实现方案
**决策**：使用 Data Layer + Polygon + 自定义渐变

**理由**：
- 可以精确控制行政区域边界
- 可以实现"从中心往边界逐渐变浅"的渐变效果
- 性能可接受，实现复杂度适中
- 未来可以升级到 WebGL Overlay View + deck.gl

### 6.2 AI对话集成方案
**决策**：使用 Google Contextual View AI kit + Grounding Lite MCP

**理由**：
- 符合需求文档要求
- 官方支持，文档完善
- 与 Google Maps 深度集成
- 支持自然语言理解和参数提取

### 6.3 产品库与计算引擎分离
**决策**：设立独立的保险产品库和风险计算引擎，两者协同工作

**理由**：
- **可扩展性**：支持未来添加更多不同类型的产品，无需修改核心计算逻辑
- **可维护性**：产品配置与业务逻辑分离，便于产品管理和规则更新
- **可测试性**：产品库和计算引擎独立，便于单元测试和集成测试
- **灵活性**：支持产品级和保单级两层定义，当前实现产品级，未来可扩展保单级

### 6.4 状态管理方案
**决策**：使用 React useState + useMemo，不引入 Redux

**理由**：
- 状态结构相对简单，不需要复杂的状态管理
- 减少依赖，保持项目轻量
- 使用 `useMemo` 可以满足性能需求

### 6.5 数据存储方案
**决策**：客户端实时生成 Mock 数据，使用 useMemo 缓存

**理由**：
- 符合当前需求（仅使用 Mock 数据）
- 无需后端服务，简化架构
- 未来可以轻松替换为真实 API 调用

---

## 7. 开发环境

### 7.1 环境要求
- **Node.js**：版本 18 或更高
- **npm**：随 Node.js 安装
- **现代浏览器**：Chrome, Firefox, Safari, Edge

### 7.2 API Key配置
- **Google Cloud Project**：`axinan-dev`
- **API Key**：`AIzaSyDySKOyx0ilGmORM-8px8Hx45jb9s28zms`
- **已开启的 API**：
  - Maps JavaScript API
  - Geocoding API（用于反向地理编码）
  - Weather API

**注意**：此 API Key 仅用于开发和测试环境，生产环境应使用环境变量或安全的密钥管理服务。

### 7.3 依赖安装
```bash
cd Next-gen-index
npm install
```

### 7.4 开发服务器
```bash
npm run dev
```

应用将在 `http://localhost:5173` 启动（或另一个可用端口）。

---

## 8. 项目约束

### 8.1 技术约束
- 前端代码已存在，需直接使用 `Next-gen-index/src` 下的代码
- 必须使用 Google Maps JavaScript API 构建地图
- AI 咨询窗口必须使用 Google Contextual View AI kit 和 Grounding Lite MCP
- 目前仅使用 Mock rainfall data，不接入真实天气 API

### 8.2 业务约束
- 历史数据最多选择 40 天内
- 预测数据默认未来 10 天
- 时间窗口需要明确起止日期和时刻（整数小时，24 小时制）
- 只能选择一个保险产品进行叠加
- 目前仅可视化产品级的风险事件触发条件，不涉及保单级

### 8.3 数据约束
- Mock rainfall data 在用户选择"市/区"后实时生成
- 时间范围：过去 40 天至未来 10 天
- 空间范围：选择的"市/区"所属的"省/州"下所有的"市/区"

---

## 9. 参考文档

### 9.1 项目文档
- **需求分析文档**：`doc/需求分析.md`
- **技术方案文档**：`doc/技术方案.md`
- **Figma详细设计**：`doc/figma-make详细设计.md`
- **实现步骤总览**：`doc/01-实现步骤总览.md`

### 9.2 Google Maps Platform 文档
- Maps JavaScript API 文档
- Advanced Markers 文档
- Data Layer 文档
- Geocoding API 文档
- Grounding with Google Maps 文档
- Contextual View Widget 文档

（通过 MCP google-maps-platform-code-assist 获取最新文档）

---

**文档版本**：v1.0  
**创建日期**：2025-01-27  
**最后更新**：2025-01-27
